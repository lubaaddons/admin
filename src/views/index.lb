<!doctype html>

<html>

	<head>
		<title>Admin - $$tablename</title>
		<link href='https://fonts.googleapis.com/css?family=Open+Sans:400,600,700,800,300' rel='stylesheet' type='text/css'>
		<script src="https://code.jquery.com/jquery-3.1.0.min.js"></script>
        <script src="//cdn.ckeditor.com/4.5.10/standard/ckeditor.js"></script>
        <script src="//cdn.ckeditor.com/4.5.10/standard/adapters/jquery.js"></script>
        <link href="<< url('admin/css') >>" rel="stylesheet" type="text/css">
	</head>

	<body>

		<header>

			<nav>

				<ul>

					<li>
						<a href="<< url('/') >>">Home</a>
					</li>

					<foreach $nav as $name => $url>

						<if Luba\Framework\URL::getInstance()->full() == $url>
						<li class="active">
						<else>
						<li>
						</if>
							<a href="$$url">$$name</a>
						</li>

					</foreach>

				</ul>

				<a href="<< url($logoutlink) >>" class="logout">
					Logout
				</a>

			</nav>

		</header>

		<main>
			<a href="<< url('admin/'.$tablename.'/create') >>" class="add">Add</a>
			<table>
				<thead>
					<tr>
						<foreach $tableconf['displayed'] as $name>
							<if is_array($name)>
								<th> << $name['name'] >> </th>
							<else>
								<th>$$name</th>
							</if>
						</foreach>
						<th></th>
						<th></th>
					<tr>
				</thead>
				<body>
					<foreach $items as $item>
						<tr>

							<foreach $tableconf['displayed'] as $col => $name>
								<if is_array($name)>
									<if $name['type'] == 'image'>
										<td>
											<a target="_blank" href="<< url($item->$col) >>">
												<php>
												$tempname = str_random(10);
												Luba\Image::make(url($item->$col))->thumbnail(100)->save(public_path('tempimages/'.$tempname))
												</php>
												<img src="<< url('tempimages/'.$tempname) >>">
											</a>
										</td>
									</if>
								<else>
									<td><< $item->$col >></td>
								</if>
							</foreach>
							<td class="edit"><a href="<< url('admin/'.$tablename.'/edit/'.$item->id) >>"  class="edit_link">Edit</a></td>
							<td class="delete"><a href="<< url('admin/'.$tablename.'/delete/'.$item->id) >>"  class="delete_link">Delete</a></td>
						</tr>
					</foreach>
				</tbody>

			</table>

			$$pagination

		</main>

	</body>

	<script>

	$(document).ready(function(){
		$('.delete_link').click(function(e){
			e.preventDefault();
			ajaxRequest($(this).attr('href'));
		});
		$('.edit_link').click(function(e){
			e.preventDefault();
			ajaxRequest($(this).attr('href'));
		})
		$('.cancel_delete').click(function(e){
			e.preventDefault();
			console.log('HUHU')
			hideoverlay();
		});
		$('.overlay').click(function(){
			hideoverlay();
		});
		$('.add').click(function(e){
			e.preventDefault();
			ajaxRequest($(this).attr('href'));
		});

		function ajaxRequest(url)
		{
			$.ajax({
				url: url
			}).done(function(data){
				overlay(data);
			});
		}
		function overlay(content)
		{
			$('body').append('<div class="overlay" onclick="hideoverlay()"></div>');
			$('.overlay').hide().fadeIn(200);
			$('body').append('<div class="ajax_container"><div class="subcontainer">' + content + '</div></div>');
			$('.ajax_container').hide().fadeIn(200);
            $('.ajax_container .html').ckeditor(function() {},{'toolbar':'basic'});
		}
	});

	</script>


</html>