<!doctype html>

<html>

	<head>
		<title>Admin - $$tablename</title>
		<link href='https://fonts.googleapis.com/css?family=Open+Sans:400,600,700,800,300' rel='stylesheet' type='text/css'>
		<script src="https://code.jquery.com/jquery-3.1.0.min.js"></script>
	</head>

	<body>

		<header>

			<nav>

				<ul>

					<li>
						<a href="<< url('/') >>">Home</a>
					</li>

					<foreach $nav as $name => $url>

						<if Luba\Framework\URL::getInstance()->full() == $url>
						<li class="active">
						<else>
						<li>
						</if>
							<a href="$$url">$$name</a>
						</li>

					</foreach>

				</ul>

				<a href="<< url($logoutlink) >>" class="logout">
					Logout
				</a>

			</nav>

		</header>

		<main>
			<a href="<< url('admin/'.$tablename.'/create') >>" class="add">Add</a>
			<table>
				<thead>
					<tr>
						<foreach $tableconf['displayed'] as $name>
							<if is_array($name)>
								<th> << $name['name'] >> </th>
							<else>
								<th>$$name</th>
							</if>
						</foreach>
						<th></th>
						<th></th>
					<tr>
				</thead>
				<body>
					<foreach $items as $item>
						<tr>

							<foreach $tableconf['displayed'] as $col => $name>
								<if is_array($name)>
									<if $name['type'] == 'image'>
										<td>
											<a target="_blank" href="<< url($item->$col) >>">
												<php>
												$tempname = str_random(10);
												Luba\Image::make(url($item->$col))->thumbnail(100)->save(public_path('tempimages/'.$tempname))
												</php>
												<img src="<< url('tempimages/'.$tempname) >>">
											</a>
										</td>
									</if>
								<else>
									<td><< $item->$col >></td>
								</if>
							</foreach>
							<td class="edit"><a href="<< url('admin/'.$tablename.'/edit/'.$item->id) >>"  class="edit_link">Edit</a></td>
							<td class="delete"><a href="<< url('admin/'.$tablename.'/delete/'.$item->id) >>"  class="delete_link">Delete</a></td>
						</tr>
					</foreach>
				</tbody>

			</table>

		</main>

	</body>

	<script>

	$(document).ready(function(){
		$('.delete_link').click(function(e){
			e.preventDefault();
			ajaxRequest($(this).attr('href'));
		});
		$('.edit_link').click(function(e){
			e.preventDefault();
			ajaxRequest($(this).attr('href'));
		})
		$('.cancel_delete').click(function(e){
			e.preventDefault();
			console.log('HUHU')
			hideoverlay();
		});
		$('.overlay').click(function(){
			hideoverlay();
		});
		$('.add').click(function(e){
			e.preventDefault();
			ajaxRequest($(this).attr('href'));
		});

		function ajaxRequest(url)
		{
			$.ajax({
				url: url
			}).done(function(data){
				overlay(data);
			});
		}
		function overlay(content)
		{
			$('body').append('<div class="overlay" onclick="hideoverlay()"></div>');
			$('.overlay').hide().fadeIn(200);
			$('body').append('<div class="ajax_container"><div class="subcontainer">' + content + '</div></div>');
			$('.ajax_container').hide().fadeIn(200);
		}
	});

	</script>

	<style>

	.overlay {
		background-color:rgba(0, 0, 0, 0.25);
		position:fixed;
		width:100%;
		height:100%;
		top:0;
		left:0;
	}
	.ajax_container {
		position:fixed;
		top:20%;
		left:50%;
		width:30%;
		margin-left:-15%;
		background-color:white;
		padding:20px;
		max-height:500px;
		overflow:hidden;
		padding-right:0;
	}
	.subcontainer {
		width:100%;
		padding-right:20px;
		max-height:500px;
		overflow-y:scroll;
	}
	.add {
		display:block;
		padding-left:5px;
	}
	.edit {
		width:30px;
	}
	.delete {
		width:50px;
	}
	table {
		width:100%;
		border-collapse: collapse;
	}
	td, th {
		padding:5px;
		text-align: left;
	}
	td {
		border-bottom:1px solid lightgrey;
	}
	th {
		border-bottom: 2px solid grey;
	}
	tbody tr:hover {
		background-color:#ffffcc;
	}
	main a:hover {
		text-decoration: underline;
	}

	</style>

	<style>
	* {
		font-family:'Open Sans', sans-serif;
	}
	body {
		margin:0;
	}
	header {
		background-color:#1f1f14;
		height:35px;
	}
	header:after {
		clear:both;
		display:table;
		content:'';
	}
	main {
		padding:40px;
	}
	ul {
		margin: 0;
		padding-left: 10px;
	}
	li.active {
		background-color:#4e4e32;
	}
	li {
		display:block;
		float:left;
		list-style-type: none;
		height:35px;
	}
	a {
		text-decoration: none;
		color: #008ae6;
		cursor:pointer;
	}
	nav a {
		display:block;
		height:100%;
		color:white;
		padding:6px 10px;
	}
	nav .logout {
		float:right;
		margin-right: 20px;
	}
	.formfield label {
		margin-bottom:10px;
		display:inline-block;
		width:200px;
	}
	input, textarea {
		width:250px;
	}
	.cancel_edit:hover {
		text-decoration:underline;
	}
	input[type="submit"] {
		width:initial;
		border:0;
		background-color:transparent;
		color:#008ae6;
		cursor:pointer;
		font-size:16px;
		padding:0;
		margin-right:10px;
		float:left;
	}
	input[type="submit"]:hover {
		text-decoration:underline;
	}
	</style>

</html>